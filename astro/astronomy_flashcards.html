<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astronomy Flashcards - Interactive Learning Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .mode-selector {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .mode-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #ff6b6b;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .mode-label {
            font-weight: bold;
            color: #333;
        }

        .timer-display {
            font-size: 2em;
            font-weight: bold;
            color: #ff6b6b;
            display: none;
        }

        .timer-display.active {
            display: block;
        }

        .timer-display.warning {
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .view-switcher {
            display: flex;
            gap: 10px;
        }

        .view-btn {
            padding: 10px 20px;
            border: 2px solid #2a5298;
            background: white;
            color: #2a5298;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .view-btn.active {
            background: #2a5298;
            color: white;
        }

        .view-btn:hover {
            transform: translateY(-2px);
        }

        .progress-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .progress-bar-container {
            background: #e0e0e0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-bar {
            background: linear-gradient(90deg, #4CAF50 0%, #8BC34A 100%);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            flex: 1;
            min-width: 120px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2a5298;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .card-container {
            perspective: 1000px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 50px 40px;
            min-height: 400px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            position: relative;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            backface-visibility: hidden;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 50px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .card-back {
            transform: rotateY(180deg);
        }

        .card-label {
            font-size: 0.9em;
            color: #2a5298;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }

        .card-content {
            font-size: 1.8em;
            color: #333;
            text-align: center;
            line-height: 1.5;
            margin-bottom: 20px;
        }

        .card-explanation {
            font-size: 1.1em;
            color: #666;
            text-align: center;
            line-height: 1.6;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .flip-hint {
            font-size: 0.9em;
            color: #999;
            text-align: center;
            margin-top: auto;
            font-style: italic;
        }

        .controls {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .confidence-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .confidence-btn {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .confidence-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        .confidence-btn:active {
            transform: translateY(0);
        }

        .btn-need-practice {
            background: #ff6b6b;
            color: white;
        }

        .btn-need-practice:hover {
            background: #ff5252;
        }

        .btn-almost {
            background: #ffd93d;
            color: #333;
        }

        .btn-almost:hover {
            background: #ffc107;
        }

        .btn-got-it {
            background: #4CAF50;
            color: white;
        }

        .btn-got-it:hover {
            background: #45a049;
        }

        .session-summary {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            display: none;
        }

        .session-summary.active {
            display: block;
        }

        .session-summary h2 {
            color: #2a5298;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .summary-stat {
            padding: 20px;
            background: #f5f5f5;
            border-radius: 10px;
        }

        .summary-stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .summary-stat-number.need-practice {
            color: #ff6b6b;
        }

        .summary-stat-number.almost {
            color: #ffc107;
        }

        .summary-stat-number.got-it {
            color: #4CAF50;
        }

        .restart-btn {
            padding: 15px 40px;
            font-size: 1.2em;
            background: #2a5298;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            background: #1e3c72;
            transform: translateY(-2px);
        }

        .learning-tip {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #2196f3;
        }

        .learning-tip strong {
            color: #1976d2;
        }

        /* Teacher Dashboard Styles */
        .teacher-dashboard {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: none;
        }

        .teacher-dashboard.active {
            display: block;
        }

        .dashboard-header {
            color: #2a5298;
            margin-bottom: 30px;
            text-align: center;
        }

        .dashboard-header h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .difficulty-chart {
            margin: 30px 0;
        }

        .card-difficulty-item {
            background: #f5f5f5;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-difficulty-item.high-difficulty {
            border-left: 5px solid #ff6b6b;
            background: #ffebee;
        }

        .card-difficulty-item.medium-difficulty {
            border-left: 5px solid #ffc107;
            background: #fff8e1;
        }

        .card-difficulty-item.low-difficulty {
            border-left: 5px solid #4CAF50;
            background: #e8f5e9;
        }

        .card-question-preview {
            flex: 1;
            font-weight: bold;
            color: #333;
        }

        .difficulty-stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .difficulty-stat {
            text-align: center;
        }

        .difficulty-stat-number {
            font-size: 1.5em;
            font-weight: bold;
        }

        .difficulty-stat-label {
            font-size: 0.8em;
            color: #666;
        }

        .dashboard-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .overview-card {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .overview-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #2a5298;
        }

        .overview-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .card {
                padding: 30px 20px;
                min-height: 350px;
            }

            .card-content {
                font-size: 1.4em;
            }

            .confidence-buttons {
                flex-direction: column;
            }

            .confidence-btn {
                min-width: 100%;
            }

            .mode-selector {
                flex-direction: column;
            }

            .view-switcher {
                width: 100%;
                justify-content: center;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ú® Astronomy Flashcards</h1>
            <p>Understanding the Starry Sky - Chapter 1</p>
        </div>

        <div class="mode-selector">
            <div class="mode-toggle">
                <span class="mode-label">‚ö° Challenge Mode (30s timer)</span>
                <label class="switch">
                    <input type="checkbox" id="challengeModeToggle" onchange="toggleChallengeMode()">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="timer-display" id="timerDisplay">30</div>
            <div class="view-switcher">
                <button class="view-btn active" id="studentViewBtn" onclick="switchView('student')">
                    üë®‚Äçüéì Student View
                </button>
                <button class="view-btn" id="teacherViewBtn" onclick="switchView('teacher')">
                    üë©‚Äçüè´ Teacher Dashboard
                </button>
            </div>
        </div>

        <!-- Student View -->
        <div id="studentView">
            <div class="progress-section">
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar">0%</div>
                </div>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-number" id="currentCard">1</div>
                        <div class="stat-label">Current Card</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="totalCards">20</div>
                        <div class="stat-label">Total Cards</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="reviewCount">0</div>
                        <div class="stat-label">Need Review</div>
                    </div>
                </div>
            </div>

            <div id="cardSection">
                <div class="card-container">
                    <div class="card" id="flashcard" onclick="flipCard()">
                        <div class="card-face card-front">
                            <div class="card-label">Question</div>
                            <div class="card-content" id="questionText"></div>
                            <div class="flip-hint">Click to reveal answer</div>
                        </div>
                        <div class="card-face card-back">
                            <div class="card-label">Answer</div>
                            <div class="card-content" id="answerText"></div>
                            <div class="card-explanation" id="explanationText"></div>
                            <div class="flip-hint">Click to return to question</div>
                        </div>
                    </div>
                </div>

                <div class="controls">
                    <div class="confidence-buttons">
                        <button class="confidence-btn btn-need-practice" onclick="rateCard('need-practice')">
                            ‚ùå Need More Practice
                        </button>
                        <button class="confidence-btn btn-almost" onclick="rateCard('almost')">
                            ü§î Almost There
                        </button>
                        <button class="confidence-btn btn-got-it" onclick="rateCard('got-it')">
                            ‚úÖ Got It!
                        </button>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px; justify-content: center;">
                        <button class="nav-btn" onclick="stopPractice()" style="background: #ff9800; color: white; border-color: #ff9800;">
                            ‚è∏Ô∏è Stop & See Progress
                        </button>
                        <button class="nav-btn" onclick="confirmRestart()">
                            üîÑ Restart Session
                        </button>
                    </div>
                    <div class="learning-tip">
                        <strong>Learning Science Tip:</strong> Try to recall the answer before flipping the card. This retrieval practice strengthens your memory more than passive review!
                    </div>
                </div>
            </div>

            <div class="session-summary" id="sessionSummary">
                <h2 id="summaryTitle">üéâ Session Complete!</h2>
                <p id="summarySubtitle" style="font-size: 1.2em; color: #666; margin-bottom: 20px;">
                    Great work! Here's how you did:
                </p>
                <div class="summary-stats">
                    <div class="summary-stat">
                        <div class="summary-stat-number need-practice" id="summaryNeedPractice">0</div>
                        <div class="stat-label">Need More Practice</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-number almost" id="summaryAlmost">0</div>
                        <div class="stat-label">Almost There</div>
                    </div>
                    <div class="summary-stat">
                        <div class="summary-stat-number got-it" id="summaryGotIt">0</div>
                        <div class="stat-label">Got It!</div>
                    </div>
                </div>
                <div id="reviewMessage" style="margin: 20px 0; font-size: 1.1em; color: #666;"></div>
                <div>
                    <button class="restart-btn" onclick="restartSession()">Start New Session</button>
                    <button class="restart-btn" onclick="switchView('teacher')">View Teacher Dashboard</button>
                </div>
            </div>
        </div>

        <!-- Teacher Dashboard -->
        <div class="teacher-dashboard" id="teacherDashboard">
            <div class="dashboard-header">
                <h2>üìä Teacher Dashboard</h2>
                <p>Aggregate data showing which concepts students struggle with most</p>
            </div>

            <div class="dashboard-overview">
                <div class="overview-card">
                    <div class="overview-number" id="totalAttempts">0</div>
                    <div class="overview-label">Total Student Attempts</div>
                </div>
                <div class="overview-card">
                    <div class="overview-number" id="avgMastery">0%</div>
                    <div class="overview-label">Average Mastery Rate</div>
                </div>
                <div class="overview-card">
                    <div class="overview-number" id="strugglingCards">0</div>
                    <div class="overview-label">High-Difficulty Cards</div>
                </div>
            </div>

            <div class="difficulty-chart">
                <h3 style="margin-bottom: 20px; color: #333;">Cards Ranked by Difficulty</h3>
                <div id="difficultyList"></div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <p style="color: #666; margin-bottom: 15px;">
                    <strong>Note:</strong> In a deployed version, this would aggregate data from all student sessions.
                    Currently showing data from local browser storage.
                </p>
                <button class="restart-btn" onclick="switchView('student')">Back to Student View</button>
                <button class="restart-btn" onclick="exportToCSV()" style="background: #4CAF50;">
                    üìä Export to CSV
                </button>
                <button class="restart-btn" onclick="resetDashboardData()" style="background: #ff6b6b;">
                    Reset Dashboard Data
                </button>
            </div>
        </div>
    </div>

    <script>
        // Flashcard data - EXPANDED TO 20 CARDS
        const flashcardsData = [
            {
                question: "What is the celestial sphere?",
                answer: "An imaginary hollow globe of stars that appears to turn around Earth",
                explanation: "The celestial sphere is a useful model for locating stars and plotting the courses of the Sun, Moon, and planets, even though we know stars are actually at different distances racing through space."
            },
            {
                question: "What are the two celestial coordinates used to locate objects in the sky?",
                answer: "Right Ascension (RA) and Declination (Dec)",
                explanation: "Similar to longitude and latitude on Earth, Right Ascension measures distance eastward along the celestial equator from the vernal equinox, while Declination measures angular distance above or below the celestial equator."
            },
            {
                question: "What is the zodiac?",
                answer: "A belt about 16¬∞ wide around the sky, centered on the ecliptic, containing 12 constellations",
                explanation: "The zodiac is special because the Sun, Moon, and planets all follow paths near the ecliptic through these 12 constellations: Pisces, Aries, Taurus, Gemini, Cancer, Leo, Virgo, Libra, Scorpius, Sagittarius, Capricornus, and Aquarius."
            },
            {
                question: "Why do different constellations appear in the sky each season?",
                answer: "Because Earth revolves around the Sun, changing our night-time view of the stars",
                explanation: "As Earth orbits the Sun throughout the year, our line of sight points toward different stars in the night sky. In 12 months we view a full circle of stars, which is why the starry sky changes with the seasons."
            },
            {
                question: "What causes Earth's seasons?",
                answer: "Earth's axis is tilted 23.5¬∞ to its orbital plane, causing different angles of sunlight during the year",
                explanation: "As Earth travels around the Sun, the tilt causes sunlight to pour down from different angles. This creates seasonal variations in the Sun's altitude, day length, and the amount of heating."
            },
            {
                question: "What is the difference between a sidereal day and a solar day?",
                answer: "A sidereal day (23h 56m 4s) measures Earth's rotation using stars; a solar day (24h) uses the Sun",
                explanation: "A solar day is about 4 minutes longer because while Earth rotates, it also moves along its orbit around the Sun. Earth must complete slightly more than one whole turn before the Sun reappears on your meridian."
            },
            {
                question: "How can you locate the North Star (Polaris) in the night sky?",
                answer: "Follow the two 'pointer stars' (Dubhe and Merak) in the bowl of the Big Dipper",
                explanation: "Polaris is important for navigation because it's the only star that seems to stay in the same spot in the sky. It's located less than one degree from the north celestial pole."
            },
            {
                question: "What are circumpolar stars?",
                answer: "Stars that never set below the horizon and are visible all year long",
                explanation: "At 40¬∞N latitude, stars within 40¬∞ of the north celestial pole (between +50¬∞ and +90¬∞ declination) are circumpolar. Examples include stars in the Big Dipper, Cassiopeia, and Ursa Minor."
            },
            {
                question: "What is precession and how does it affect the sky?",
                answer: "The slow wobbling of Earth's axis in a 25,800-year cycle that changes which star is the polestar",
                explanation: "Earth's axis shifts slowly around a cone in space, caused mainly by gravitational tugs from the Sun and Moon. This means Polaris won't always be the North Star - Thuban was the polestar in 3000 B.C., and Vega will be in 14,000 A.D."
            },
            {
                question: "What are the four key positions of the Sun during the year?",
                answer: "Vernal equinox (Mar 20), Summer solstice (Jun 21), Autumnal equinox (Sep 23), Winter solstice (Dec 21)",
                explanation: "At the equinoxes, the Sun crosses the celestial equator and day equals night. At the solstices, the Sun reaches its most northern and southern positions, creating the longest and shortest days in the northern hemisphere."
            },
            {
                question: "What is the ecliptic?",
                answer: "The apparent path of the Sun against the background stars throughout the year",
                explanation: "The ecliptic is tilted 23.5¬∞ to the celestial equator because Earth's axis is tilted. The Moon and planets also follow paths near the ecliptic, which is why they appear in the zodiac constellations."
            },
            {
                question: "Name the 12 constellations of the zodiac in order starting from Aries.",
                answer: "Aries, Taurus, Gemini, Cancer, Leo, Virgo, Libra, Scorpius, Sagittarius, Capricornus, Aquarius, Pisces",
                explanation: "These 12 constellations form a belt around the sky through which the Sun appears to travel during the year. Ancient astrologers divided the zodiac into these signs, each extending about 30¬∞ of longitude."
            },
            {
                question: "What are your zenith, celestial horizon, and celestial meridian?",
                answer: "Zenith: point directly overhead; Horizon: great circle 90¬∞ from zenith; Meridian: great circle through zenith and poles",
                explanation: "These are local reference lines that stay fixed with you as an observer while sky objects pass by. They help you describe where objects are in your sky at any given moment."
            },
            {
                question: "Why does the Sun's altitude in the sky change throughout the year?",
                answer: "Because Earth's axis is tilted 23.5¬∞ to its orbital plane around the Sun",
                explanation: "This tilt remains constant as Earth orbits, so the angle between Earth and the Sun changes. The Sun appears highest at summer solstice and lowest at winter solstice in the northern hemisphere."
            },
            {
                question: "What is a constellation?",
                answer: "A recognized pattern of stars in the sky, or one of 88 official sections of the celestial sphere",
                explanation: "Ancient peoples named constellations after animals and mythological figures. Modern astronomers use the historical names to refer to 88 sections of the sky rather than the mythical figures, helping to locate celestial objects."
            },
            {
                question: "What is apparent magnitude and what does it measure?",
                answer: "A measure of how bright a sky object appears from Earth, with lower numbers being brighter",
                explanation: "The ancient Greek astronomer Hipparchus created this scale. The brightest stars have negative magnitudes (Sirius is -1.44), while the faintest objects visible in space telescopes are around +31. A difference of 1 magnitude means a brightness ratio of about 2.5."
            },
            {
                question: "How do you determine the altitude of the North Star at your location?",
                answer: "The altitude of Polaris above your northern horizon equals your latitude",
                explanation: "This relationship makes Polaris useful for navigation. At the North Pole (90¬∞N), Polaris is at your zenith (90¬∞ altitude). At the equator (0¬∞), Polaris is on your horizon (0¬∞ altitude)."
            },
            {
                question: "Why do stars rise about 4 minutes earlier each night?",
                answer: "Because a sidereal day is 4 minutes shorter than a solar day due to Earth's orbital motion",
                explanation: "Earth must rotate slightly more than 360¬∞ for the Sun to return to the same position (solar day), but exactly 360¬∞ for stars to return (sidereal day). This 4-minute daily difference accumulates to 2 hours per month."
            },
            {
                question: "Where would you need to be for the Sun to pass directly through your zenith at summer solstice?",
                answer: "At the Tropic of Cancer (23.5¬∞N latitude)",
                explanation: "The Sun's declination ranges from +23.5¬∞ at summer solstice to -23.5¬∞ at winter solstice. It can only pass through your zenith if you're at a latitude equal to its current declination."
            },
            {
                question: "How many stars can you see with the unaided eye on a clear, dark night?",
                answer: "About 2,000 stars",
                explanation: "In a built-up area with light pollution, you can see only the brightest stars. But when you're far from city lights and the sky is very dark and clear, you can see about 2,000 stars with your unaided eye, looking trillions of kilometers into space."
            }
        ];

        // State management
        let currentCardIndex = 0;
        let isFlipped = false;
        let cardQueue = [];
        let sessionStats = {
            needPractice: 0,
            almost: 0,
            gotIt: 0
        };
        let challengeMode = false;
        let timer = null;
        let timeRemaining = 30;
        let currentView = 'student';

        // Teacher dashboard data (stored in localStorage)
        function getTeacherData() {
            const stored = localStorage.getItem('astronomyFlashcardsTeacherData');
            if (stored) {
                return JSON.parse(stored);
            }
            // Initialize with empty data for each card
            return flashcardsData.map((card, index) => ({
                question: card.question,
                needPracticeCount: 0,
                almostCount: 0,
                gotItCount: 0,
                totalAttempts: 0
            }));
        }

        function saveTeacherData(data) {
            localStorage.setItem('astronomyFlashcardsTeacherData', JSON.stringify(data));
        }

        function updateTeacherData(cardIndex, rating) {
            const teacherData = getTeacherData();
            teacherData[cardIndex].totalAttempts++;

            if (rating === 'need-practice') {
                teacherData[cardIndex].needPracticeCount++;
            } else if (rating === 'almost') {
                teacherData[cardIndex].almostCount++;
            } else if (rating === 'got-it') {
                teacherData[cardIndex].gotItCount++;
            }

            saveTeacherData(teacherData);
        }

        // Challenge Mode Timer
        function startTimer() {
            if (!challengeMode) return;

            timeRemaining = 30;
            updateTimerDisplay();

            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();

                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    // Auto-flip if not already flipped
                    if (!isFlipped) {
                        flipCard();
                    }
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const display = document.getElementById('timerDisplay');
            display.textContent = timeRemaining + 's';

            if (timeRemaining <= 10) {
                display.classList.add('warning');
            } else {
                display.classList.remove('warning');
            }
        }

        function stopTimer() {
            if (timer) {
                clearInterval(timer);
                timer = null;
            }
        }

        function toggleChallengeMode() {
            challengeMode = document.getElementById('challengeModeToggle').checked;
            const timerDisplay = document.getElementById('timerDisplay');

            if (challengeMode) {
                timerDisplay.classList.add('active');
                startTimer();
            } else {
                timerDisplay.classList.remove('active');
                stopTimer();
            }
        }

        // View Switching
        function switchView(view) {
            currentView = view;

            if (view === 'student') {
                document.getElementById('studentView').style.display = 'block';
                document.getElementById('teacherDashboard').classList.remove('active');
                document.getElementById('studentViewBtn').classList.add('active');
                document.getElementById('teacherViewBtn').classList.remove('active');
            } else {
                document.getElementById('studentView').style.display = 'none';
                document.getElementById('teacherDashboard').classList.add('active');
                document.getElementById('studentViewBtn').classList.remove('active');
                document.getElementById('teacherViewBtn').classList.add('active');
                renderTeacherDashboard();
            }
        }

        // Render Teacher Dashboard
        function renderTeacherDashboard() {
            const teacherData = getTeacherData();

            // Calculate overview stats
            let totalAttempts = 0;
            let totalNeedPractice = 0;
            let totalGotIt = 0;

            teacherData.forEach(card => {
                totalAttempts += card.totalAttempts;
                totalNeedPractice += card.needPracticeCount;
                totalGotIt += card.gotItCount;
            });

            const avgMastery = totalAttempts > 0 ? Math.round((totalGotIt / totalAttempts) * 100) : 0;
            const strugglingCards = teacherData.filter(card => {
                if (card.totalAttempts === 0) return false;
                const struggleRate = card.needPracticeCount / card.totalAttempts;
                return struggleRate > 0.4;
            }).length;

            document.getElementById('totalAttempts').textContent = totalAttempts;
            document.getElementById('avgMastery').textContent = avgMastery + '%';
            document.getElementById('strugglingCards').textContent = strugglingCards;

            // Sort cards by difficulty (highest need-practice rate first)
            const sortedCards = [...teacherData].map((card, index) => ({
                ...card,
                index,
                difficultyScore: card.totalAttempts > 0 ? card.needPracticeCount / card.totalAttempts : 0
            })).sort((a, b) => b.difficultyScore - a.difficultyScore);

            // Render difficulty list
            const difficultyList = document.getElementById('difficultyList');
            difficultyList.innerHTML = '';

            sortedCards.forEach(card => {
                if (card.totalAttempts === 0) return; // Skip cards with no attempts

                const item = document.createElement('div');
                let difficultyClass = 'low-difficulty';
                if (card.difficultyScore > 0.4) {
                    difficultyClass = 'high-difficulty';
                } else if (card.difficultyScore > 0.2) {
                    difficultyClass = 'medium-difficulty';
                }

                item.className = `card-difficulty-item ${difficultyClass}`;
                item.innerHTML = `
                    <div class="card-question-preview">${card.question}</div>
                    <div class="difficulty-stats">
                        <div class="difficulty-stat">
                            <div class="difficulty-stat-number" style="color: #ff6b6b;">${card.needPracticeCount}</div>
                            <div class="difficulty-stat-label">Need Practice</div>
                        </div>
                        <div class="difficulty-stat">
                            <div class="difficulty-stat-number" style="color: #ffc107;">${card.almostCount}</div>
                            <div class="difficulty-stat-label">Almost</div>
                        </div>
                        <div class="difficulty-stat">
                            <div class="difficulty-stat-number" style="color: #4CAF50;">${card.gotItCount}</div>
                            <div class="difficulty-stat-label">Got It</div>
                        </div>
                        <div class="difficulty-stat">
                            <div class="difficulty-stat-number" style="color: #2a5298;">${Math.round(card.difficultyScore * 100)}%</div>
                            <div class="difficulty-stat-label">Difficulty</div>
                        </div>
                    </div>
                `;
                difficultyList.appendChild(item);
            });

            if (sortedCards.filter(c => c.totalAttempts > 0).length === 0) {
                difficultyList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">No student data yet. Complete a study session to see analytics.</p>';
            }
        }

        function resetDashboardData() {
            if (confirm('Are you sure you want to reset all teacher dashboard data? This cannot be undone.')) {
                localStorage.removeItem('astronomyFlashcardsTeacherData');
                renderTeacherDashboard();
                alert('Dashboard data has been reset.');
            }
        }

        // Export teacher analytics to CSV
        function exportToCSV() {
            const teacherData = getTeacherData();

            // Check if there's any data to export
            const hasData = teacherData.some(card => card.totalAttempts > 0);
            if (!hasData) {
                alert('No data to export yet. Students need to complete study sessions first.');
                return;
            }

            // Create CSV header
            let csv = 'Card Number,Question,Need Practice,Almost There,Got It,Total Attempts,Difficulty Score (%),Mastery Rate (%)\n';

            // Add data rows
            teacherData.forEach((card, index) => {
                const cardNumber = index + 1;
                const question = `"${card.question.replace(/"/g, '""')}"`;  // Escape quotes
                const needPractice = card.needPracticeCount;
                const almost = card.almostCount;
                const gotIt = card.gotItCount;
                const totalAttempts = card.totalAttempts;
                const difficultyScore = totalAttempts > 0 ? Math.round((card.needPracticeCount / totalAttempts) * 100) : 0;
                const masteryRate = totalAttempts > 0 ? Math.round((card.gotItCount / totalAttempts) * 100) : 0;

                csv += `${cardNumber},${question},${needPractice},${almost},${gotIt},${totalAttempts},${difficultyScore},${masteryRate}\n`;
            });

            // Add summary statistics
            csv += '\n';
            csv += 'Summary Statistics\n';
            csv += 'Metric,Value\n';

            const totalAttempts = teacherData.reduce((sum, card) => sum + card.totalAttempts, 0);
            const totalNeedPractice = teacherData.reduce((sum, card) => sum + card.needPracticeCount, 0);
            const totalAlmost = teacherData.reduce((sum, card) => sum + card.almostCount, 0);
            const totalGotIt = teacherData.reduce((sum, card) => sum + card.gotItCount, 0);
            const avgMastery = totalAttempts > 0 ? Math.round((totalGotIt / totalAttempts) * 100) : 0;
            const strugglingCards = teacherData.filter(card => {
                if (card.totalAttempts === 0) return false;
                return (card.needPracticeCount / card.totalAttempts) > 0.4;
            }).length;

            csv += `Total Student Attempts,${totalAttempts}\n`;
            csv += `Total "Need Practice" Responses,${totalNeedPractice}\n`;
            csv += `Total "Almost There" Responses,${totalAlmost}\n`;
            csv += `Total "Got It" Responses,${totalGotIt}\n`;
            csv += `Average Mastery Rate,${avgMastery}%\n`;
            csv += `High-Difficulty Cards (>40% struggle rate),${strugglingCards}\n`;
            csv += `Number of Cards with Data,${teacherData.filter(c => c.totalAttempts > 0).length}\n`;

            // Create download link
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            // Generate filename with current date
            const today = new Date();
            const dateString = today.toISOString().split('T')[0]; // YYYY-MM-DD format
            const filename = `astronomy_flashcards_analytics_${dateString}.csv`;

            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            // Show success message
            alert(`Analytics exported successfully!\n\nFile: ${filename}\n\nThe CSV file will open in Excel, Google Sheets, or any spreadsheet application.`);
        }

        // Initialize the application
        function init() {
            // Create initial queue with all cards
            cardQueue = flashcardsData.map((card, index) => ({
                ...card,
                originalIndex: index,
                reviewCount: 0
            }));

            shuffleArray(cardQueue);
            showCard();
            updateProgress();
        }

        // Shuffle array using Fisher-Yates algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Display current card
        function showCard() {
            if (currentCardIndex >= cardQueue.length) {
                showSummary();
                return;
            }

            const card = cardQueue[currentCardIndex];
            document.getElementById('questionText').textContent = card.question;
            document.getElementById('answerText').textContent = card.answer;
            document.getElementById('explanationText').textContent = card.explanation;

            // Reset flip state
            if (isFlipped) {
                flipCard();
            }

            // Start timer if challenge mode is on
            if (challengeMode) {
                startTimer();
            }
        }

        // Flip card animation
        function flipCard() {
            const card = document.getElementById('flashcard');
            card.classList.toggle('flipped');
            isFlipped = !isFlipped;

            // Stop timer when flipped
            if (isFlipped && challengeMode) {
                stopTimer();
            }
        }

        // Rate card and implement spaced repetition
        function rateCard(rating) {
            const card = cardQueue[currentCardIndex];

            // Update teacher dashboard data
            updateTeacherData(card.originalIndex, rating);

            // Update statistics
            if (rating === 'need-practice') {
                sessionStats.needPractice++;
                card.reviewCount++;

                // Add back to queue for review (spaced repetition)
                const insertPosition = Math.min(
                    currentCardIndex + Math.floor(Math.random() * 3) + 2,
                    cardQueue.length
                );
                cardQueue.splice(insertPosition, 0, {...card});

            } else if (rating === 'almost') {
                sessionStats.almost++;
                card.reviewCount++;

                // Add back to queue but further away
                const insertPosition = Math.min(
                    currentCardIndex + Math.floor(Math.random() * 3) + 4,
                    cardQueue.length
                );
                cardQueue.splice(insertPosition, 0, {...card});

            } else if (rating === 'got-it') {
                sessionStats.gotIt++;
                // Don't add back to queue
            }

            currentCardIndex++;
            stopTimer();
            updateProgress();
            showCard();
        }

        // Update progress indicators
        function updateProgress() {
            const totalReviewed = sessionStats.needPractice + sessionStats.almost + sessionStats.gotIt;
            const totalOriginal = flashcardsData.length;
            const progress = Math.min((totalReviewed / totalOriginal) * 100, 100);

            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressBar').textContent = Math.round(progress) + '%';

            const cardsNeedingReview = cardQueue.slice(currentCardIndex).filter(c => c.reviewCount > 0).length;
            document.getElementById('currentCard').textContent = Math.min(currentCardIndex + 1, cardQueue.length);
            document.getElementById('reviewCount').textContent = cardsNeedingReview;
        }

        // Show session summary
        function showSummary(isPartialSession = false) {
            stopTimer();
            document.getElementById('cardSection').classList.add('hidden');
            document.getElementById('sessionSummary').classList.add('active');

            document.getElementById('summaryNeedPractice').textContent = sessionStats.needPractice;
            document.getElementById('summaryAlmost').textContent = sessionStats.almost;
            document.getElementById('summaryGotIt').textContent = sessionStats.gotIt;

            // Update title and subtitle based on completion status
            const total = sessionStats.needPractice + sessionStats.almost + sessionStats.gotIt;
            if (isPartialSession) {
                document.getElementById('summaryTitle').textContent = '‚è∏Ô∏è Practice Session Paused';
                document.getElementById('summarySubtitle').textContent = `You reviewed ${total} out of ${flashcardsData.length} cards. Here's your progress:`;
            } else {
                document.getElementById('summaryTitle').textContent = 'üéâ Session Complete!';
                document.getElementById('summarySubtitle').textContent = 'Great work! Here\'s how you did:';
            }

            // Generate encouraging message
            const masteryPercent = total > 0 ? Math.round((sessionStats.gotIt / total) * 100) : 0;

            let message = '';
            if (total === 0) {
                message = 'Start practicing to see your progress!';
            } else if (masteryPercent >= 80) {
                message = `üåü Excellent! You've mastered ${masteryPercent}% of the material you reviewed. You're ready to move forward!`;
            } else if (masteryPercent >= 60) {
                message = `üëç Good progress! You've mastered ${masteryPercent}% of the material you reviewed. Review the challenging cards again to strengthen your understanding.`;
            } else {
                message = `üí™ Keep practicing! You've mastered ${masteryPercent}% of the material you reviewed. Regular review will help these concepts stick. Remember: retrieval practice is the key to learning!`;
            }

            document.getElementById('reviewMessage').textContent = message;
        }

        // Stop practice session early
        function stopPractice() {
            const total = sessionStats.needPractice + sessionStats.almost + sessionStats.gotIt;
            if (total === 0) {
                alert('You haven\'t reviewed any cards yet. Rate at least one card before stopping.');
                return;
            }

            const confirmed = confirm(`You've reviewed ${total} out of ${flashcardsData.length} cards.\n\nAre you sure you want to stop and see your progress?`);
            if (confirmed) {
                showSummary(true); // true indicates partial session
            }
        }

        // Confirm restart during active session
        function confirmRestart() {
            const total = sessionStats.needPractice + sessionStats.almost + sessionStats.gotIt;
            if (total > 0) {
                const confirmed = confirm(`You've already reviewed ${total} cards.\n\nRestarting will reset your progress and start fresh. Continue?`);
                if (!confirmed) return;
            }
            restartSession();
        }

        // Restart the session
        function restartSession() {
            currentCardIndex = 0;
            isFlipped = false;
            sessionStats = {
                needPractice: 0,
                almost: 0,
                gotIt: 0
            };
            stopTimer();

            document.getElementById('sessionSummary').classList.remove('active');
            document.getElementById('cardSection').classList.remove('hidden');

            init();
        }

        // Start the application
        init();
    </script>
</body>
</html>